"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Emitter=void 0;var _vue=_interopRequireDefault(require("vue"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _classPrivateFieldGet(e,t){var r=t.get(e);if(!r)throw new TypeError("attempted to get private field on non-instance");return r.get?r.get.call(e):r.value}function _classPrivateFieldSet(e,t,r){var i=t.get(e);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(e,r);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=r}return r}var Emitter=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),_defaultOptions.set(this,{writable:!0,value:{separator:"."}}),_ee.set(this,{writable:!0,value:void 0}),_listeners.set(this,{writable:!0,value:{}}),_aoListeners.set(this,{writable:!0,value:new WeakMap}),_options.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_ee,new _vue.default),_classPrivateFieldSet(this,_options,_objectSpread({},_classPrivateFieldGet(this,_defaultOptions),{},e))}return _createClass(t,[{key:"_namespace",value:function(e,i){var n=this;"object"!==_typeof(e)&&(e=[e]);var a=[];return e.forEach(function(e){var t=e.split(_classPrivateFieldGet(n,_options).separator),r=t.shift();a.push(r),t.length||t.push("__no-ns__"),t.forEach(function(e){_classPrivateFieldGet(n,_listeners)[r]||(_classPrivateFieldGet(n,_listeners)[r]={}),_classPrivateFieldGet(n,_listeners)[r][e]||(_classPrivateFieldGet(n,_listeners)[r][e]=[]),_classPrivateFieldGet(n,_listeners)[r][e].push(i)})}),a}},{key:"emit",value:function(){return _classPrivateFieldGet(this,_ee).$emit.apply(_classPrivateFieldGet(this,_ee),Array.prototype.slice.call(arguments)),this}},{key:"off",value:function(e,t){var d=this,r=0<arguments.length&&void 0!==e?e:[],l=1<arguments.length?t:void 0;return Array.isArray(r)||(r=[r]),r.length||r.push(""),r.forEach(function(e){var p=e.split(_classPrivateFieldGet(d,_options).separator),s=p.shift(),o=[],v=new WeakMap;Object.keys(_classPrivateFieldGet(d,_listeners)).forEach(function(r){if(!s||r===s)for(var e=0,t=Object.entries(_classPrivateFieldGet(d,_listeners)[r]);e<t.length;e++){var i=_slicedToArray(t[e],2),n=i[0],a=i[1];(!p.length||0<=p.indexOf(n))&&a.forEach(function(e){if(!l||l===e){var t=v.get(e);(t=t||{})[r]||(t[r]=0),t[r]++,v.set(e,t),-1==o.indexOf(e)&&o.push(e)}})}}),o.forEach(function(e){for(var t=v.get(e),r=0,i=Object.entries(t);r<i.length;r++){var n=_slicedToArray(i[r],2),a=n[0],s=n[1];if(!p.length||s===p.length){_classPrivateFieldGet(d,_ee).$off(a,e);for(var o=0,l=Object.entries(_classPrivateFieldGet(d,_listeners)[a]);o<l.length;o++){var c=_slicedToArray(l[o],2),f=c[0],u=c[1];0<=u.indexOf(e)&&(u.splice(u.indexOf(e),1),u.length||(delete _classPrivateFieldGet(d,_listeners)[a][f],Object.keys(_classPrivateFieldGet(d,_listeners)[a]).length||delete _classPrivateFieldGet(d,_listeners)[a]))}var _=_classPrivateFieldGet(d,_aoListeners).get(e);_&&_[a]&&_classPrivateFieldGet(d,_ee).$off(a,_[a])}}})}),this}},{key:"on",value:function(e,t){var r=this._namespace(e,t);return _classPrivateFieldGet(this,_ee).$on(r,t),this}},{key:"once",value:function(e,t){var r=this,i=this._namespace(e,t);_classPrivateFieldGet(this,_ee).$on(i,t);function n(){r.off(e,t)}_classPrivateFieldGet(this,_ee).$once(i[0],n);var a=_classPrivateFieldGet(this,_aoListeners).get(t);return(a=a||{})[i[0]]=n,_classPrivateFieldGet(this,_aoListeners).set(t,a),this}}]),t}();exports.Emitter=Emitter;var _defaultOptions=new WeakMap,_ee=new WeakMap,_listeners=new WeakMap,_aoListeners=new WeakMap,_options=new WeakMap,_default=Emitter;exports.default=_default;